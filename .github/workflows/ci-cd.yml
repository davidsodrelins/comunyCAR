name: CI/CD Pipeline\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main, develop]\n\njobs:\n  # Job 1: Testes do Backend\n  backend-tests:\n    runs-on: ubuntu-latest\n    \n    services:\n      mysql:\n        image: mysql:8.0\n        env:\n          MYSQL_ROOT_PASSWORD: root\n          MYSQL_DATABASE: comunycar_test\n        options: >-\n          --health-cmd=\"mysqladmin ping\"\n          --health-interval=10s\n          --health-timeout=5s\n          --health-retries=3\n        ports:\n          - 3306:3306\n\n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n          cache: 'pnpm'\n      \n      - name: Install pnpm\n        run: npm install -g pnpm\n      \n      - name: Install dependencies\n        run: pnpm install\n      \n      - name: Run backend tests\n        run: pnpm test\n        env:\n          DATABASE_URL: mysql://root:root@localhost:3306/comunycar_test\n      \n      - name: Run linter\n        run: pnpm lint\n\n  # Job 2: Build do Backend\n  backend-build:\n    runs-on: ubuntu-latest\n    needs: backend-tests\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n          cache: 'pnpm'\n      \n      - name: Install pnpm\n        run: npm install -g pnpm\n      \n      - name: Install dependencies\n        run: pnpm install\n      \n      - name: Build backend\n        run: pnpm build\n\n  # Job 3: Testes do Frontend\n  frontend-tests:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n          cache: 'npm'\n          cache-dependency-path: 'client/package-lock.json'\n      \n      - name: Install dependencies\n        run: cd client && npm install\n      \n      - name: Run frontend tests\n        run: cd client && npm test\n      \n      - name: Run linter\n        run: cd client && npm run lint\n\n  # Job 4: Build do Frontend\n  frontend-build:\n    runs-on: ubuntu-latest\n    needs: frontend-tests\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Node.js\n        uses: actions/setup-node@v3\n        with:\n          node-version: '18'\n          cache: 'npm'\n          cache-dependency-path: 'client/package-lock.json'\n      \n      - name: Install dependencies\n        run: cd client && npm install\n      \n      - name: Build frontend\n        run: cd client && npm run build\n      \n      - name: Upload build artifacts\n        uses: actions/upload-artifact@v3\n        with:\n          name: frontend-build\n          path: client/dist\n\n  # Job 5: Deploy para Staging\n  deploy-staging:\n    runs-on: ubuntu-latest\n    needs: [backend-build, frontend-build]\n    if: github.ref == 'refs/heads/develop'\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Deploy to staging\n        run: |\n          echo \"Deploying to staging...\"\n          # Adicionar comandos de deploy aqui\n        env:\n          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}\n          STAGING_HOST: ${{ secrets.STAGING_HOST }}\n\n  # Job 6: Deploy para Production\n  deploy-production:\n    runs-on: ubuntu-latest\n    needs: [backend-build, frontend-build]\n    if: github.ref == 'refs/heads/main'\n    \n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Deploy to production\n        run: |\n          echo \"Deploying to production...\"\n          # Adicionar comandos de deploy aqui\n        env:\n          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}\n          PRODUCTION_HOST: ${{ secrets.PRODUCTION_HOST }}\n      \n      - name: Create release\n        uses: actions/create-release@v1\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n        with:\n          tag_name: v${{ github.run_number }}\n          release_name: Release v${{ github.run_number }}\n          body: |\n            Changes in this release:\n            - Backend tests passed\n            - Frontend tests passed\n            - All builds successful\n          draft: false\n          prerelease: false\n
