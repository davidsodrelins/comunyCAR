# comunyCAR - DocumentaÃ§Ã£o Completa\n\n## ğŸ“‹ Ãndice\n\n1. [VisÃ£o Geral](#visÃ£o-geral)\n2. [Arquitetura](#arquitetura)\n3. [InstalaÃ§Ã£o](#instalaÃ§Ã£o)\n4. [ConfiguraÃ§Ã£o](#configuraÃ§Ã£o)\n5. [API](#api)\n6. [Frontend](#frontend)\n7. [Mobile](#mobile)\n8. [Deployment](#deployment)\n9. [Troubleshooting](#troubleshooting)\n\n---\n\n## ğŸ¯ VisÃ£o Geral\n\n**comunyCAR** Ã© um sistema completo que permite que usuÃ¡rios enviem alertas sobre problemas em veÃ­culos atravÃ©s da placa.\n\n### Funcionalidades Principais\n\n- âœ… Cadastro e autenticaÃ§Ã£o de usuÃ¡rios\n- âœ… GestÃ£o de veÃ­culos (Owner e UsuÃ¡rios SecundÃ¡rios)\n- âœ… Envio de alertas fixos (gratuitos) e personalizados (com crÃ©ditos)\n- âœ… Sistema de reaÃ§Ãµes em mensagens\n- âœ… NotificaÃ§Ãµes multi-canal (Email, WhatsApp, Push)\n- âœ… Compra de crÃ©ditos via PayPal\n- âœ… Dashboard com estatÃ­sticas\n- âœ… HistÃ³rico de alertas e transaÃ§Ãµes\n\n---\n\n## ğŸ—ï¸ Arquitetura\n\n### Stack TecnolÃ³gico\n\n**Backend:**\n- Node.js + Express\n- tRPC para API type-safe\n- MySQL para banco de dados\n- Firebase Cloud Messaging\n- PayPal API\n- Nodemailer para emails\n- whatsapp-web.js para WhatsApp\n\n**Frontend:**\n- React + TypeScript\n- Tailwind CSS\n- shadcn/ui para componentes\n- tRPC Client\n\n**Mobile:**\n- Flutter\n- Firebase Cloud Messaging\n- Provider para gerenciamento de estado\n\n### Estrutura de DiretÃ³rios\n\n```\ncomunyCAR/\nâ”œâ”€â”€ backend/\nâ”‚   â”œâ”€â”€ server/\nâ”‚   â”‚   â”œâ”€â”€ routers/           # tRPC routers\nâ”‚   â”‚   â”œâ”€â”€ services/          # ServiÃ§os (Email, WhatsApp, Firebase, PayPal)\nâ”‚   â”‚   â”œâ”€â”€ middleware/        # Middlewares (Rate Limiting)\nâ”‚   â”‚   â”œâ”€â”€ utils/             # UtilitÃ¡rios (Validadores)\nâ”‚   â”‚   â””â”€â”€ webhooks/          # Webhooks (PayPal)\nâ”‚   â””â”€â”€ drizzle/               # Schema do banco de dados\nâ”œâ”€â”€ client/\nâ”‚   â””â”€â”€ src/\nâ”‚       â”œâ”€â”€ pages/             # PÃ¡ginas da aplicaÃ§Ã£o\nâ”‚       â”œâ”€â”€ components/        # Componentes reutilizÃ¡veis\nâ”‚       â””â”€â”€ lib/               # UtilitÃ¡rios e configuraÃ§Ãµes\nâ””â”€â”€ mobile-flutter/\n    â””â”€â”€ lib/\n        â”œâ”€â”€ screens/           # Telas do app\n        â”œâ”€â”€ services/          # ServiÃ§os\n        â””â”€â”€ providers/         # Providers (State Management)\n```\n\n---\n\n## ğŸš€ InstalaÃ§Ã£o\n\n### PrÃ©-requisitos\n\n- Node.js 16+\n- npm ou pnpm\n- MySQL 8+\n- Git\n\n### Backend\n\n```bash\ncd backend\npnpm install\npnpm db:push\npnpm dev\n```\n\n### Frontend\n\n```bash\ncd client\nnpm install\nnpm run dev\n```\n\n### Mobile\n\n```bash\ncd mobile-flutter\nflutter pub get\nflutter run\n```\n\n---\n\n## âš™ï¸ ConfiguraÃ§Ã£o\n\n### VariÃ¡veis de Ambiente\n\nCrie um arquivo `.env.local` na raiz do backend:\n\n```env\n# Banco de Dados\nDATABASE_URL=mysql://user:password@localhost:3306/comunycar\n\n# JWT\nJWT_SECRET=seu-secret-muito-seguro\n\n# Email (SMTP)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USER=seu-email@gmail.com\nSMTP_PASS=sua-senha-app\n\n# Firebase\nFIREBASE_PROJECT_ID=seu-projeto\nFIREBASE_PRIVATE_KEY=sua-chave-privada\nFIREBASE_CLIENT_EMAIL=seu-email@firebase.gserviceaccount.com\n\n# PayPal\nPAYPAL_CLIENT_ID=seu-client-id\nPAYPAL_CLIENT_SECRET=seu-secret\nPAYPAL_MODE=sandbox # ou production\n\n# WhatsApp\nWHATSAPP_PHONE=seu-numero\n```\n\n---\n\n## ğŸ“¡ API\n\n### AutenticaÃ§Ã£o\n\n**POST /api/trpc/auth.register**\n```json\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"senha123\",\n  \"name\": \"JoÃ£o Silva\",\n  \"phone\": \"(11) 99999-9999\",\n  \"cnpj\": \"00.000.000/0000-00\"\n}\n```\n\n**POST /api/trpc/auth.login**\n```json\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"senha123\"\n}\n```\n\n### VeÃ­culos\n\n**POST /api/trpc/vehicles.create**\n```json\n{\n  \"plate\": \"ABC-1234\",\n  \"brand\": \"Toyota\",\n  \"model\": \"Corolla\",\n  \"color\": \"Branco\"\n}\n```\n\n**GET /api/trpc/vehicles.list**\n- Retorna lista de veÃ­culos do usuÃ¡rio\n\n### Alertas\n\n**POST /api/trpc/alerts.sendFixed**\n```json\n{\n  \"vehicleId\": 1,\n  \"alertType\": \"farol_aceso\"\n}\n```\n\n**POST /api/trpc/alerts.sendPersonalized**\n```json\n{\n  \"vehicleId\": 1,\n  \"message\": \"Mensagem personalizada\"\n}\n```\n\n### CrÃ©ditos\n\n**GET /api/trpc/credits.getBalance**\n- Retorna saldo de crÃ©ditos\n\n**POST /api/trpc/payments.createPayment**\n```json\n{\n  \"amount\": 50,\n  \"credits\": 100,\n  \"returnUrl\": \"https://seu-site.com/success\",\n  \"cancelUrl\": \"https://seu-site.com/cancel\"\n}\n```\n\n---\n\n## ğŸ¨ Frontend\n\n### PÃ¡ginas Principais\n\n1. **Landing** - PÃ¡gina inicial para nÃ£o autenticados\n2. **Login** - AutenticaÃ§Ã£o de usuÃ¡rios\n3. **SignUp** - Cadastro com validaÃ§Ã£o de CNPJ\n4. **VerifyEmail** - VerificaÃ§Ã£o de email com token\n5. **Dashboard** - Painel principal com estatÃ­sticas\n6. **SendAlert** - Envio de alertas\n7. **Vehicles** - GestÃ£o de veÃ­culos\n8. **BuyCredits** - Compra de crÃ©ditos via PayPal\n9. **UserProfile** - Perfil e configuraÃ§Ãµes\n10. **ReceivedMessages** - Mensagens recebidas com reaÃ§Ãµes\n11. **SentMessages** - Mensagens enviadas com status\n\n### Componentes\n\n- `Button` - BotÃ£o padrÃ£o\n- `Card` - Card para conteÃºdo\n- `Input` - Campo de entrada\n- `Dialog` - Modal\n- `Toast` - NotificaÃ§Ã£o\n\n---\n\n## ğŸ“± Mobile\n\n### Telas Flutter\n\n1. **SplashScreen** - Tela de carregamento\n2. **LoginScreen** - Login\n3. **HomeScreen** - Dashboard com 5 abas\n4. **SendAlertScreen** - Envio de alertas\n5. **VehiclesScreen** - GestÃ£o de veÃ­culos\n6. **CreditsScreen** - Compra de crÃ©ditos\n7. **SettingsScreen** - ConfiguraÃ§Ãµes\n\n### IntegraÃ§Ã£o Firebase\n\n```dart\nFinal messaging = FirebaseMessaging.instance;\nString? token = await messaging.getToken();\n```\n\n### Som de Buzina\n\n```dart\nawait _notificationService.playHornSound();\n```\n\n---\n\n## ğŸŒ Deployment\n\n### Backend (Ubuntu VPS)\n\n```bash\n# 1. Clonar repositÃ³rio\ngit clone https://github.com/davidsodrelins/comunyCAR.git\ncd comunyCAR\n\n# 2. Instalar dependÃªncias\npnpm install\n\n# 3. Configurar variÃ¡veis de ambiente\ncp .env.example .env.local\n# Editar .env.local com suas credenciais\n\n# 4. Migrar banco de dados\npnpm db:push\n\n# 5. Iniciar servidor\npnpm start\n```\n\n### Frontend (Vercel/Netlify)\n\n```bash\n# Conectar repositÃ³rio GitHub\n# Configurar variÃ¡veis de ambiente\n# Deploy automÃ¡tico\n```\n\n### Mobile (App Store/Play Store)\n\n```bash\nflutter build apk   # Android\nflutter build ios   # iOS\n```\n\n---\n\n## ğŸ”§ Troubleshooting\n\n### Erro: \"Banco de dados nÃ£o disponÃ­vel\"\n\n```bash\n# Verificar conexÃ£o MySQL\nmysql -u user -p -h localhost\n\n# Verificar DATABASE_URL em .env.local\n```\n\n### Erro: \"Token de Firebase invÃ¡lido\"\n\n```bash\n# Verificar arquivo serviceAccountKey.json\n# Verificar credenciais em .env.local\n```\n\n### Erro: \"Rate limit excedido\"\n\n- Aguarde 15 minutos para login\n- Aguarde 1 hora para envio de alertas\n\n---\n\n## ğŸ“š ReferÃªncias\n\n- [tRPC Documentation](https://trpc.io)\n- [Firebase Documentation](https://firebase.google.com/docs)\n- [PayPal API](https://developer.paypal.com)\n- [Flutter Documentation](https://flutter.dev/docs)\n- [React Documentation](https://react.dev)\n\n---\n\n## ğŸ“ Suporte\n\nPara dÃºvidas ou problemas:\n\n1. Verificar [Issues](https://github.com/davidsodrelins/comunyCAR/issues)\n2. Criar nova issue com detalhes\n3. Contatar desenvolvedor\n\n---\n\n**Ãšltima atualizaÃ§Ã£o:** 2024\n**VersÃ£o:** 1.0.0\n
