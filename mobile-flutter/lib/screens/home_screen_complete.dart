import 'package:flutter/material.dart';\nimport 'package:firebase_messaging/firebase_messaging.dart';\nimport '../services/notification_service.dart';\nimport '../services/api_service.dart';\n\nclass HomeScreenComplete extends StatefulWidget {\n  const HomeScreenComplete({Key? key}) : super(key: key);\n\n  @override\n  State<HomeScreenComplete> createState() => _HomeScreenCompleteState();\n}\n\nclass _HomeScreenCompleteState extends State<HomeScreenComplete> {\n  final NotificationService _notificationService = NotificationService();\n  final ApiService _apiService = ApiService();\n  int _selectedIndex = 0;\n  bool _isLoading = true;\n\n  late Map<String, dynamic> _userStats = {\n    'totalAlerts': 0,\n    'creditsBalance': 0,\n    'vehicleCount': 0,\n    'unreadMessages': 0,\n  };\n\n  @override\n  void initState() {\n    super.initState();\n    _initializeApp();\n  }\n\n  Future<void> _initializeApp() async {\n    try {\n      // Inicializar notificações\n      await _notificationService.initializeNotifications();\n      \n      // Registrar token de push\n      String? token = await FirebaseMessaging.instance.getToken();\n      if (token != null) {\n        await _apiService.registerPushToken(token, 'android');\n      }\n\n      // Carregar dados do usuário\n      await _loadUserStats();\n\n      setState(() {\n        _isLoading = false;\n      });\n    } catch (e) {\n      print('Erro ao inicializar app: $e');\n      setState(() {\n        _isLoading = false;\n      });\n    }\n  }\n\n  Future<void> _loadUserStats() async {\n    try {\n      final stats = await _apiService.getUserStats();\n      setState(() {\n        _userStats = stats;\n      });\n    } catch (e) {\n      print('Erro ao carregar estatísticas: $e');\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('comunyCAR'),\n        elevation: 0,\n        backgroundColor: Colors.blue[600],\n        actions: [\n          IconButton(\n            icon: const Icon(Icons.notifications),\n            onPressed: () {\n              // Navegar para mensagens\n            },\n          ),\n          IconButton(\n            icon: const Icon(Icons.person),\n            onPressed: () {\n              // Navegar para perfil\n            },\n          ),\n        ],\n      ),\n      body: _isLoading\n          ? const Center(child: CircularProgressIndicator())\n          : _buildBody(),\n      bottomNavigationBar: BottomNavigationBar(\n        currentIndex: _selectedIndex,\n        onTap: (index) {\n          setState(() {\n            _selectedIndex = index;\n          });\n        },\n        items: const [\n          BottomNavigationBarItem(\n            icon: Icon(Icons.home),\n            label: 'Home',\n          ),\n          BottomNavigationBarItem(\n            icon: Icon(Icons.warning),\n            label: 'Alertas',\n          ),\n          BottomNavigationBarItem(\n            icon: Icon(Icons.directions_car),\n            label: 'Veículos',\n          ),\n          BottomNavigationBarItem(\n            icon: Icon(Icons.wallet),\n            label: 'Créditos',\n          ),\n          BottomNavigationBarItem(\n            icon: Icon(Icons.settings),\n            label: 'Config',\n          ),\n        ],\n      ),\n    );\n  }\n\n  Widget _buildBody() {\n    switch (_selectedIndex) {\n      case 0:\n        return _buildHomeTab();\n      case 1:\n        return _buildAlertsTab();\n      case 2:\n        return _buildVehiclesTab();\n      case 3:\n        return _buildCreditsTab();\n      case 4:\n        return _buildSettingsTab();\n      default:\n        return _buildHomeTab();\n    }\n  }\n\n  Widget _buildHomeTab() {\n    return SingleChildScrollView(\n      padding: const EdgeInsets.all(16),\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.start,\n        children: [\n          // Header\n          Text(\n            'Bem-vindo!',\n            style: Theme.of(context).textTheme.headlineSmall,\n          ),\n          const SizedBox(height: 16),\n\n          // Stats Cards\n          GridView.count(\n            crossAxisCount: 2,\n            shrinkWrap: true,\n            physics: const NeverScrollableScrollPhysics(),\n            mainAxisSpacing: 16,\n            crossAxisSpacing: 16,\n            children: [\n              _buildStatCard(\n                'Alertas',\n                _userStats['totalAlerts'].toString(),\n                Icons.warning,\n                Colors.red,\n              ),\n              _buildStatCard(\n                'Créditos',\n                _userStats['creditsBalance'].toString(),\n                Icons.wallet,\n                Colors.green,\n              ),\n              _buildStatCard(\n                'Veículos',\n                _userStats['vehicleCount'].toString(),\n                Icons.directions_car,\n                Colors.blue,\n              ),\n              _buildStatCard(\n                'Mensagens',\n                _userStats['unreadMessages'].toString(),\n                Icons.mail,\n                Colors.purple,\n              ),\n            ],\n          ),\n          const SizedBox(height: 24),\n\n          // Quick Actions\n          Text(\n            'Ações Rápidas',\n            style: Theme.of(context).textTheme.titleMedium,\n          ),\n          const SizedBox(height: 12),\n          SizedBox(\n            width: double.infinity,\n            child: ElevatedButton.icon(\n              icon: const Icon(Icons.warning),\n              label: const Text('Enviar Alerta'),\n              onPressed: () {\n                // Navegar para enviar alerta\n              },\n            ),\n          ),\n          const SizedBox(height: 8),\n          SizedBox(\n            width: double.infinity,\n            child: ElevatedButton.icon(\n              icon: const Icon(Icons.add),\n              label: const Text('Adicionar Veículo'),\n              onPressed: () {\n                // Navegar para adicionar veículo\n              },\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n\n  Widget _buildAlertsTab() {\n    return Center(\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Icon(\n            Icons.warning,\n            size: 64,\n            color: Colors.grey[300],\n          ),\n          const SizedBox(height: 16),\n          Text(\n            'Nenhum alerta recente',\n            style: Theme.of(context).textTheme.titleMedium,\n          ),\n        ],\n      ),\n    );\n  }\n\n  Widget _buildVehiclesTab() {\n    return Center(\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Icon(\n            Icons.directions_car,\n            size: 64,\n            color: Colors.grey[300],\n          ),\n          const SizedBox(height: 16),\n          Text(\n            'Nenhum veículo cadastrado',\n            style: Theme.of(context).textTheme.titleMedium,\n          ),\n          const SizedBox(height: 16),\n          ElevatedButton(\n            onPressed: () {\n              // Navegar para adicionar veículo\n            },\n            child: const Text('Adicionar Veículo'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  Widget _buildCreditsTab() {\n    return Center(\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          Icon(\n            Icons.wallet,\n            size: 64,\n            color: Colors.grey[300],\n          ),\n          const SizedBox(height: 16),\n          Text(\n            'Saldo: ${_userStats['creditsBalance']} créditos',\n            style: Theme.of(context).textTheme.headlineSmall,\n          ),\n          const SizedBox(height: 16),\n          ElevatedButton(\n            onPressed: () {\n              // Navegar para comprar créditos\n            },\n            child: const Text('Comprar Créditos'),\n          ),\n        ],\n      ),\n    );\n  }\n\n  Widget _buildSettingsTab() {\n    return ListView(\n      children: [\n        ListTile(\n          title: const Text('Notificações'),\n          trailing: const Icon(Icons.chevron_right),\n          onTap: () {\n            // Navegar para configurações de notificação\n          },\n        ),\n        ListTile(\n          title: const Text('Perfil'),\n          trailing: const Icon(Icons.chevron_right),\n          onTap: () {\n            // Navegar para perfil\n          },\n        ),\n        ListTile(\n          title: const Text('Segurança'),\n          trailing: const Icon(Icons.chevron_right),\n          onTap: () {\n            // Navegar para segurança\n          },\n        ),\n        ListTile(\n          title: const Text('Sobre'),\n          trailing: const Icon(Icons.chevron_right),\n          onTap: () {\n            // Mostrar sobre\n          },\n        ),\n        ListTile(\n          title: const Text('Sair'),\n          trailing: const Icon(Icons.logout),\n          onTap: () {\n            // Fazer logout\n          },\n        ),\n      ],\n    );\n  }\n\n  Widget _buildStatCard(\n    String title,\n    String value,\n    IconData icon,\n    Color color,\n  ) {\n    return Card(\n      child: Padding(\n        padding: const EdgeInsets.all(16),\n        child: Column(\n          mainAxisAlignment: MainAxisAlignment.center,\n          children: [\n            Icon(icon, size: 32, color: color),\n            const SizedBox(height: 8),\n            Text(\n              value,\n              style: Theme.of(context).textTheme.headlineSmall,\n            ),\n            const SizedBox(height: 4),\n            Text(\n              title,\n              style: Theme.of(context).textTheme.bodySmall,\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n
