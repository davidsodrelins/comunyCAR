import React, { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell } from \"recharts\";\nimport { Loader2, AlertCircle, CheckCircle, TrendingUp, Users, MessageSquare, Zap } from \"lucide-react\";\nimport { useWebSocket, useWebSocketEvent } from \"@/hooks/useWebSocket\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface DashboardStats {\n  totalMessages: number;\n  totalAlerts: number;\n  totalCreditsUsed: number;\n  totalUsers: number;\n  onlineUsers: number;\n  whatsappConnected: boolean;\n}\n\ninterface ChartData {\n  time: string;\n  messages: number;\n  alerts: number;\n  reactions: number;\n}\n\ninterface AlertTypeData {\n  name: string;\n  value: number;\n}\n\nconst COLORS = [\"#3b82f6\", \"#ef4444\", \"#10b981\", \"#f59e0b\", \"#8b5cf6\", \"#ec4899\"];\n\nexport default function RealtimeDashboard() {\n  const { user } = useAuth();\n  const { isConnected, isConnecting, error } = useWebSocket();\n  const [stats, setStats] = useState<DashboardStats>({\n    totalMessages: 0,\n    totalAlerts: 0,\n    totalCreditsUsed: 0,\n    totalUsers: 0,\n    onlineUsers: 0,\n    whatsappConnected: false,\n  });\n  const [chartData, setChartData] = useState<ChartData[]>([\n    { time: \"00:00\", messages: 0, alerts: 0, reactions: 0 },\n    { time: \"06:00\", messages: 12, alerts: 5, reactions: 8 },\n    { time: \"12:00\", messages: 28, alerts: 15, reactions: 20 },\n    { time: \"18:00\", messages: 35, alerts: 22, reactions: 28 },\n    { time: \"23:59\", messages: 42, alerts: 28, reactions: 35 },\n  ]);\n  const [alertTypes, setAlertTypes] = useState<AlertTypeData[]>([\n    { name: \"Faróis\", value: 35 },\n    { name: \"Pneu\", value: 25 },\n    { name: \"Porta\", value: 20 },\n    { name: \"Vazamento\", value: 15 },\n    { name: \"Alarme\", value: 5 },\n  ]);\n\n  /**\n   * Listener: Nova mensagem\n   */\n  useWebSocketEvent(\"new-message\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      totalMessages: prev.totalMessages + 1,\n    }));\n  });\n\n  /**\n   * Listener: Alerta enviado\n   */\n  useWebSocketEvent(\"alert-sent\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      totalAlerts: prev.totalAlerts + 1,\n    }));\n  });\n\n  /**\n   * Listener: Créditos atualizados\n   */\n  useWebSocketEvent(\"credits-updated\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      totalCreditsUsed: prev.totalCreditsUsed + Math.abs(data.change),\n    }));\n  });\n\n  /**\n   * Listener: Usuário online\n   */\n  useWebSocketEvent(\"user-online\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      onlineUsers: Math.min(prev.onlineUsers + 1, prev.totalUsers),\n    }));\n  });\n\n  /**\n   * Listener: Usuário offline\n   */\n  useWebSocketEvent(\"user-offline\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      onlineUsers: Math.max(prev.onlineUsers - 1, 0),\n    }));\n  });\n\n  /**\n   * Listener: Status WhatsApp\n   */\n  useWebSocketEvent(\"whatsapp-status\", (data) => {\n    setStats((prev) => ({\n      ...prev,\n      whatsappConnected: data.status === \"connected\",\n    }));\n  });\n\n  return (\n    <div className=\"container mx-auto py-8 px-4\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2\">Dashboard em Tempo Real</h1>\n        <p className=\"text-gray-600\">\n          Monitore estatísticas e eventos do sistema em tempo real\n        </p>\n      </div>\n\n      {/* Status de Conexão */}\n      <div className=\"mb-6\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                {isConnecting && <Loader2 className=\"w-5 h-5 animate-spin\" />}\n                {isConnected && !isConnecting && (\n                  <CheckCircle className=\"w-5 h-5 text-green-600\" />\n                )}\n                {!isConnected && !isConnecting && (\n                  <AlertCircle className=\"w-5 h-5 text-red-600\" />\n                )}\n                <div>\n                  <p className=\"font-semibold\">\n                    {isConnecting\n                      ? \"Conectando...\"\n                      : isConnected\n                      ? \"Conectado\"\n                      : \"Desconectado\"}\n                  </p>\n                  {error && <p className=\"text-sm text-red-600\">{error}</p>}\n                </div>\n              </div>\n              <Badge variant={isConnected ? \"default\" : \"secondary\"}>\n                {isConnected ? \"Online\" : \"Offline\"}\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Estatísticas Principais */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-gray-600\">\n              Mensagens\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-3xl font-bold\">{stats.totalMessages}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">Total recebidas</p>\n              </div>\n              <MessageSquare className=\"w-8 h-8 text-blue-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-gray-600\">\n              Alertas\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-3xl font-bold\">{stats.totalAlerts}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">Total enviados</p>\n              </div>\n              <TrendingUp className=\"w-8 h-8 text-red-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-gray-600\">\n              Créditos Usados\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-3xl font-bold\">{stats.totalCreditsUsed}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">Consumidos</p>\n              </div>\n              <Zap className=\"w-8 h-8 text-yellow-500\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-gray-600\">\n              Usuários Online\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-3xl font-bold\">{stats.onlineUsers}</p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  de {stats.totalUsers}\n                </p>\n              </div>\n              <Users className=\"w-8 h-8 text-green-500\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Status do WhatsApp */}\n      <div className=\"mb-8\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Status do WhatsApp</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"font-semibold\">Conexão WhatsApp</p>\n                <p className=\"text-sm text-gray-600 mt-1\">\n                  {stats.whatsappConnected\n                    ? \"Conectado e pronto para enviar mensagens\"\n                    : \"Desconectado. Configure no painel de administração\"}\n                </p>\n              </div>\n              <Badge\n                variant={stats.whatsappConnected ? \"default\" : \"secondary\"}\n              >\n                {stats.whatsappConnected ? \"Ativo\" : \"Inativo\"}\n              </Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Gráficos */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n        {/* Gráfico de Linha: Atividade ao Longo do Dia */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Atividade ao Longo do Dia</CardTitle>\n            <CardDescription>\n              Mensagens, alertas e reações por hora\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <LineChart data={chartData}>\n                <CartesianGrid strokeDasharray=\"3 3\" />\n                <XAxis dataKey=\"time\" />\n                <YAxis />\n                <Tooltip />\n                <Legend />\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"messages\"\n                  stroke=\"#3b82f6\"\n                  name=\"Mensagens\"\n                />\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"alerts\"\n                  stroke=\"#ef4444\"\n                  name=\"Alertas\"\n                />\n                <Line\n                  type=\"monotone\"\n                  dataKey=\"reactions\"\n                  stroke=\"#10b981\"\n                  name=\"Reações\"\n                />\n              </LineChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        {/* Gráfico de Pizza: Tipos de Alertas */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Distribuição de Alertas</CardTitle>\n            <CardDescription>Tipos de alertas mais comuns</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <PieChart>\n                <Pie\n                  data={alertTypes}\n                  cx=\"50%\"\n                  cy=\"50%\"\n                  labelLine={false}\n                  label={({ name, value }) => `${name}: ${value}`}\n                  outerRadius={80}\n                  fill=\"#8884d8\"\n                  dataKey=\"value\"\n                >\n                  {alertTypes.map((entry, index) => (\n                    <Cell\n                      key={`cell-${index}`}\n                      fill={COLORS[index % COLORS.length]}\n                    />\n                  ))}\n                </Pie>\n                <Tooltip />\n              </PieChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Gráfico de Barras: Comparação de Métricas */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Comparação de Métricas</CardTitle>\n          <CardDescription>\n            Análise comparativa de atividades\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <ResponsiveContainer width=\"100%\" height={300}>\n            <BarChart data={chartData}>\n              <CartesianGrid strokeDasharray=\"3 3\" />\n              <XAxis dataKey=\"time\" />\n              <YAxis />\n              <Tooltip />\n              <Legend />\n              <Bar dataKey=\"messages\" fill=\"#3b82f6\" name=\"Mensagens\" />\n              <Bar dataKey=\"alerts\" fill=\"#ef4444\" name=\"Alertas\" />\n              <Bar dataKey=\"reactions\" fill=\"#10b981\" name=\"Reações\" />\n            </BarChart>\n          </ResponsiveContainer>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n
